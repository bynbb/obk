<?xml version="1.0" encoding="UTF-8"?>
<gsl-prompt id="20250804T014131+0000" type="feat">
<gsl-header>

# Correcting Limitations in GSL Schema and Validation Logic
</gsl-header>
<gsl-block>
<gsl-purpose>
<gsl-title>

## Purpose
</gsl-title>
<gsl-description>

This prompt directs the work of addressing and resolving known limitations in the current GSL schema and validation implementation, as described in `gsl-implementation-limitations.md`. The goal is to unify validation logic, enhance extensibility, reduce maintenance overhead, and improve future-proofing for both humans and automation agents.

</gsl-description>
</gsl-purpose>
<gsl-inputs>
<gsl-title>

## Inputs
</gsl-title>
<gsl-description>

- gsl-implementation-limitations.md
- prompt-template-for-codex-agents.md
- obk-release-workflow.md
- grit-structured-language-gsl.md
- new-gsl-elements-and-capabilities.md
- adhoc-task-template-for-codex-agents.md

</gsl-description>
</gsl-inputs>

<gsl-outputs>
<gsl-title>

## Outputs
</gsl-title>
<gsl-description>

- [x] Validation logic uses a single source of truth for schema (XSD) and is reinforced by implementation (Python checks)
- [x] Schema and Python validator enforce placement and requirement of `<gsl-document-spec>` as last in `<gsl-block>`
- [x] Error messages now consistently highlight ordering, duplication, and missing required elements, including `<gsl-document-spec>`
- [x] Validation of required fields in surgery elements (`<gsl-when>`, `<gsl-what>`, etc.) and explicit reporting for missing `<gsl-value>`
- [x] Tests confirm that the most common structure, ordering, and constraint errors are surfaced by both XSD and Python validation

</gsl-description>
</gsl-outputs>

<gsl-workflows>
<gsl-title>

## Workflows
</gsl-title>
<gsl-description>

#### 1. Prompt Typing with `type` Attribute

- When creating a new `<gsl-prompt>`, specify the `type` attribute (e.g., `feat`, `fix`, `docs`) to categorize the prompt for downstream automation and changelog generation.
- Downstream tools and workflows (release scripts, changelog automation) can filter or format prompts based on their `type`.

#### 2. Documenting Changes with `<gsl-surgery>`

- Use `<gsl-surgery>` in a prompt to record breaking changes, removals, or structural revisions.
    - Each `<gsl-surgery>` contains subfields: `<gsl-when>`, `<gsl-what>`, `<gsl-why>`, `<gsl-impact>`, and `<gsl-action>`.
    - Each subfield **must** include a `<gsl-value>`, and may include `<gsl-label>` or `<gsl-title>` for context.
- This enables automated extraction of historical changes and their rationale for audits or migration notes.

#### 3. Standardized Metadata with Global Elements

- Place `<gsl-label>`, `<gsl-title>`, and `<gsl-value>` as the first children (in any order, but before any other elements) within supported containers (`<gsl-block>`, surgery fields, etc.).
    - `<gsl-label>` is for UI-style field labels (e.g., for data-entry or display in tools).
    - `<gsl-title>` provides a concise, human-readable section heading.
    - `<gsl-value>` holds the main value for the field (text, date, or ID).
- This enables consistent parsing, display, and mapping in UI, automation, or reporting pipelines.

#### 4. Validation and Harmonization Workflow

- Run `obk validate-all` to enforce the ordering and presence of required global elements, prompt typing, and the structure of `<gsl-surgery>` sections.
- Run `obk harmonize-all` to reformat or reorder prompt files so that all global elements appear first and sections are in the required order.

#### 5. Migration and Extensibility

- When adding new elements or attributes, update the XSD schema as the **single source of truth**.
- Use `<gsl-label>`, `<gsl-title>`, and `<gsl-value>` in all new non-text elements to maintain consistency.
- Ensure new workflows or audit fields follow the pattern of being enforced both at the schema and validator level.

</gsl-description>
</gsl-workflows>

<gsl-tdd>

<gsl-title>

## 5. Tests
</gsl-title>
<gsl-test id="T1">

T1: Confirm all pain points in the limitations article are directly addressed in the unified validation logic.
</gsl-test>
<gsl-test id="T2">

T2: Test that adding new global or audit elements requires updating only the single source of truth, not both schema and code separately.
</gsl-test>
<gsl-test id="T3">

T3: Check that documentation provides step-by-step migration and extension guidance.
</gsl-test>
<gsl-test id="T4">

T4: Validate that usability improvements (error messages, warnings) are surfaced in both schema and runtime checks.
</gsl-test>
<gsl-test id="T5">

T5: Verify all instructions for mixed-content, meta, or audit extensibility are captured and testable.
</gsl-test>
<gsl-test id="T6">

T6: Ensure sample port to another language/toolchain is possible using the new validation specification.
</gsl-test>
<gsl-test id="T7">

T7: obk validate-all fails when a &lt;gsl-when&gt; lacks &lt;gsl-value&gt;.
</gsl-test>
<gsl-test id="T8">

T8: Prompt 20250804T130000+0000: Validates a complete, correct schema</gsl-test>
<gsl-test id="T9">

T9: Prompt 20250804T130001+0000: Fails for missing &lt;gsl-document-spec&gt;</gsl-test>
<gsl-test id="T10">

T10: Prompt 20250804T130002+0000: Fails when &lt;gsl-document-spec&gt; is not last in &lt;gsl-block&gt;</gsl-test>
<gsl-test id="T11">

T11: Prompt 20250804T130003+0000: Fails when &lt;gsl-when&gt; missing required &lt;gsl-value&gt;</gsl-test>
<gsl-test id="T12">

T12: Prompt 20250804T130004+0000: Fails for invalid &lt;gsl-surgery&gt; placement</gsl-test>

</gsl-tdd>
<gsl-document-spec>
<gsl-title>

## 6. Document Specification
</gsl-title>
<gsl-description>

#### Overview

This section defines the rules and conventions for maintaining and updating this prompt document.
This specification applies only to this prompt document.

#### S-1. Identifier and Numbering

Major sections and tests in this document must use a clear, hierarchical ID. Use an uppercase prefix and numbers, like `T1`, `T2.1`, or `S1.2.3`:

* Use `T` for tests in `<gsl-tdd>` (e.g., `T1`, `T2.1`).
* Use `S` for specification items if needed (e.g., `S1`, `S2.1`).
* Number all items in order, with no gaps or repeats.
* Do not remove or change IDs except to fix errors.

These IDs are required for referencing, tracking, and audits.

#### S-2. Update Policy

These rules apply to automated changes by agents. Manual edits by maintainers can update any section.

* Agents **may only** update these sections:

  * `<gsl-workflows>` (agents may add, change, or remove any part)
  * `<gsl-tdd>` (agents may add new `<gsl-test>` elements, but may not change or remove any existing `<gsl-test>`)
* Agents **must not** change or remove any other content in this document.

These rules protect the integrity of the document and its tests, while allowing agents to add workflows and new tests.

#### S-3. Tests Section

* `<gsl-tdd>` holds one or more `<gsl-test>` elements.
* Each `<gsl-test>` must start with a single-line description and have a unique `id` (e.g., `T1`, `T2`, etc).
* You may add a code block (with triple backticks) below the test description if needed.
* Agents may only add new `<gsl-test>` elements. They must not change or remove any existing test.
* Only maintainers can change or remove tests.
* Use these tests for auditing and validation.
</gsl-description>
</gsl-document-spec>
</gsl-block>
</gsl-prompt>
