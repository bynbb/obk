<?xml version="1.0" encoding="UTF-8"?>
<gsl-prompt id="20250804T004020+0000" type="feat">
<gsl-description>

<!--
This is a self-contained prompt and spec for OBK/Codex agent work.
- Inputs, outputs, workflows, and tests are listed below.
- All document rules and agent policies are defined in the "Document Specification" section.
- Agents may only update workflows and add new tests (see rules).
- Everything else is for maintainers to edit as needed.
- This file should be easy to read and quick to update—no hidden steps or dependencies.
-->
</gsl-description>

<gsl-header>

# Repository, XSD, and Workflow Update
</gsl-header>

<gsl-block>

<gsl-purpose>
<gsl-title>

## 1. Purpose
</gsl-title>
<gsl-description>

Update the OBK repository and automation to support and validate all new and extended GSL elements and conventions.
</gsl-description>
</gsl-purpose>

<gsl-inputs>
<gsl-title>

## 2. Inputs
</gsl-title>
<gsl-description>

| Input | Notes |
| --- | --- |
| xsd file | Current GSL schema (for extension) |
| obk-release-workflow.md | Article describing the release workflow |
| obk-release-workflow.md | (Duplicate reference for clarity; used for validation and documentation) |
| grit-structured-language-gsl.md | GSL overview and rules |
| new-gsl-elements-and-capabilities.md | Article detailing the new elements, rules, and conventions |
| one-line-manual-tests.md | Rationale/examples for single-line manual tests |
| adhoc-task-template-for-codex-agents.md | Template for Codex ad-hoc tasks |
| Prompt stub (20250804T004020+0000) | For use as a validation subject and reference for outputs/testing |

</gsl-description>
</gsl-inputs>

<gsl-outputs>
<gsl-title>

## 3. Outputs
</gsl-title>
<gsl-description>

- [x] XSD schema updated to support all new/extended elements and attributes
    - The XSD supports `<gsl-label>`, `<gsl-title>`, `<gsl-value>`, the `type` attribute, and `<gsl-surgery>` (with required subfields).
- [x] Example prompt files using new schema and elements
    - Example prompts with correct use of the new schema and all new elements exist and are used in tests.
- [x] OBK CLI and Codex/agent logic updated for new schema/validation
    - `obk` CLI and validator logic have been updated to recognize and validate the schema structure, including new elements and required ordering.

</gsl-description>
</gsl-outputs>

<gsl-workflows>
<gsl-title>

## 4. Workflows
</gsl-title>
<gsl-description>

- Review and update the XSD schema for new GSL elements
- Update example prompt files with new elements, structure, and attributes
- Update OBK CLI and agent automation to support and validate new schema
- Update CI/CD pipelines and automation for validation, harmonization, and enforcement
- Manual and automated testing of all new features.

</gsl-description>
</gsl-workflows>

<gsl-tdd>

<gsl-title>

## 5. Tests
</gsl-title>
<gsl-description>

Each test below ensures a required output is completed and validated according to the new and extended GSL conventions.
</gsl-description>

<gsl-test id="T1">

- T1: Validate that the XSD schema is updated to allow new elements and attributes (gsl-label, gsl-title, gsl-value, gsl-surgery, type)
</gsl-test>

<gsl-test id="T2">

- T2: Confirm that new example prompt files include correct usage of all new GSL elements. 
</gsl-test>

<gsl-test id="T3">

- T3: Verify OBK CLI and Codex agent logic accept and validate new schema and conventions (including validation of non-text elements and global element cardinality)
</gsl-test>

<gsl-test id="T4">

- T4: Check CI/CD and automation scripts properly validate, harmonize, and enforce new rules. 
</gsl-test>

<gsl-test id="T5">

- T5: Manual test—open, edit, and validate a prompt file (using 20250804T004020+0000) with new elements and verify expected tool and automation behaviors
</gsl-test>

<gsl-test id="T6">

- T6: pytest tests/test_prompt_features.py::test_validate_all -q => passed</gsl-test>

<gsl-test id="T7">

- T7: pytest tests/test_prompt_features.py::test_surgery_requires_value -q => passed</gsl-test>

<gsl-test id="T8">

- T8: obk validate-all --prompts-dir prompts => All prompt files are valid</gsl-test>

<gsl-test id="T9">

- T9: pytest -q => passed</gsl-test>

</gsl-tdd>

<gsl-document-spec>
<gsl-title>

## 6. Document Specification
</gsl-title>
<gsl-description>

#### Overview

This section defines the rules and conventions for maintaining and updating this prompt document.
This specification applies only to this prompt document.

#### S-1. Identifier and Numbering

Major sections and tests in this document must use a clear, hierarchical ID. Use an uppercase prefix and numbers, like `T1`, `T2.1`, or `S1.2.3`:

* Use `T` for tests in `<gsl-tdd>` (e.g., `T1`, `T2.1`).
* Use `S` for specification items if needed (e.g., `S1`, `S2.1`).
* Number all items in order, with no gaps or repeats.
* Do not remove or change IDs except to fix errors.

These IDs are required for referencing, tracking, and audits.

#### S-2. Update Policy

These rules apply to automated changes by agents. Manual edits by maintainers can update any section.

* Agents **may only** update these sections:

  * `<gsl-workflows>` (agents may add, change, or remove any part)
  * `<gsl-tdd>` (agents may add new `<gsl-test>` elements, but may not change or remove any existing `<gsl-test>`)
* Agents **must not** change or remove any other content in this document.

These rules protect the integrity of the document and its tests, while allowing agents to add workflows and new tests.

#### S-3. Tests Section

* `<gsl-tdd>` holds one or more `<gsl-test>` elements.
* Each `<gsl-test>` must start with a single-line description and have a unique `id` (e.g., `T1`, `T2`, etc).
* You may add a code block (with triple backticks) below the test description if needed.
* Agents may only add new `<gsl-test>` elements. They must not change or remove any existing test.
* Only maintainers can change or remove tests.
* Use these tests for auditing and validation.

</gsl-description>
</gsl-document-spec>
</gsl-block>
</gsl-prompt>
